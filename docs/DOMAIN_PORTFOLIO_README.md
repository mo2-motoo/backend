# Portfolio Domain Documentation

## π“‹ κ°μ”

Portfolio λ„λ©”μΈμ€ μ‚¬μ©μμ λ³΄μ  μ£Όμ‹ κ΄€λ¦¬μ™€ ν¬νΈν΄λ¦¬μ¤ λ¶„μ„μ„ λ‹΄λ‹Ήν•λ” ν•µμ‹¬ λ„λ©”μΈμ…λ‹λ‹¤. μ‚¬μ©μκ°€ λ³΄μ ν• μ£Όμ‹ μ •λ³΄, ν¬νΈν΄λ¦¬μ¤ κ°€μΉ κ³„μ‚°, μμµλ¥  λ¶„μ„, κ·Έλ¦¬κ³  ν¬νΈν΄λ¦¬μ¤ μµμ ν™”λ¥Ό μ§€μ›ν•©λ‹λ‹¤.

## π—οΈ Entity κµ¬μ΅°

### Portfolio Entity κ΄€κ³„λ„

```mermaid
erDiagram
    USER_STOCK {
        Long id PK
        Long quantity
        Long averageBuyPrice
    }

    USER {
        Long id PK
        String username
        Long cash
        Long seedMoney
    }

    STOCK {
        String stockCode PK
        String stockName
        String marketType
    }

    USER ||--o{ USER_STOCK : "owns"
    STOCK ||--o{ USER_STOCK : "held_by"
```

<details>
<summary>π“„ Entity μ½”λ“ λ³΄κΈ°</summary>

```java
@Entity
@Getter
@NoArgsConstructor(access = lombok.AccessLevel.PROTECTED)
@Builder
@AllArgsConstructor
public class UserStock extends BaseEntity {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "user_id")
    private User user;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "stock_id")
    private Stock stock;

    @Column(nullable = false)
    private Long quantity;

    @Column(nullable = false)
    private Long averageBuyPrice; // ν‰λ‹¨κ°€

    public void updateQuantity(Long quantity) {
        this.quantity = quantity;
    }

    public void updateAverageBuyPrice(Long averageBuyPrice) {
        this.averageBuyPrice = averageBuyPrice;
    }
} 
```

</details>

## π”§ μ£Όμ” κΈ°λ¥

### 1. λ³΄μ  μ£Όμ‹ κ΄€λ¦¬

- **λ³΄μ  μ£Όμ‹ μ΅°ν**: μ‚¬μ©μλ³„ λ³΄μ  μ£Όμ‹ λ©λ΅ μ΅°ν
- **λ³΄μ  μ£Όμ‹ μ—…λ°μ΄νΈ**: λ§¤μ/λ§¤λ„ μ‹ λ³΄μ  μ£Όμ‹ μ •λ³΄ μ—…λ°μ΄νΈ
- **ν‰λ‹¨κ°€ κ³„μ‚°**: λ§¤μ μ‹ ν‰κ·  λ§¤μκ°€ μλ™ κ³„μ‚°
- **λ³΄μ  κΈ°κ°„ κ΄€λ¦¬**: μ£Όμ‹ λ³΄μ  κΈ°κ°„ μ¶”μ 

### 2. ν¬νΈν΄λ¦¬μ¤ λ¶„μ„

- **ν¬νΈν΄λ¦¬μ¤ κ°€μΉ κ³„μ‚°**: μ‹¤μ‹κ°„ ν¬νΈν΄λ¦¬μ¤ μ΄ κ°€μΉ
- **μμµλ¥  λ¶„μ„**: μΆ…λ©λ³„, μ „μ²΄ ν¬νΈν΄λ¦¬μ¤ μμµλ¥ 
- **λ¶„μ‚°λ„ λ¶„μ„**: ν¬νΈν΄λ¦¬μ¤ λ¶„μ‚° λ° λ¦¬μ¤ν¬ λ¶„μ„
- **μ„±κ³Ό μ§€ν‘**: ROI, Sharpe Ratio λ“± κ³„μ‚°

### 3. ν¬νΈν΄λ¦¬μ¤ μµμ ν™”

- **μμ‚° λ°°λ¶„ λ¶„μ„**: μΆ…λ©λ³„ μμ‚° λ°°λ¶„ ν„ν™©
- **λ¦¬λ°Έλ°μ‹± μ μ•**: μµμ  μμ‚° λ°°λ¶„ μ μ•
- **λ¦¬μ¤ν¬ κ΄€λ¦¬**: ν¬νΈν΄λ¦¬μ¤ λ¦¬μ¤ν¬ ν‰κ°€

## π“ λΉ„μ¦λ‹μ¤ ν”λ΅μ°

### ν¬νΈν΄λ¦¬μ¤ μ΅°ν ν”λ΅μ°

```mermaid
graph TD
    A[ν¬νΈν΄λ¦¬μ¤ μ΅°ν μ”μ²­] --> B[μ‚¬μ©μ λ³΄μ  μ£Όμ‹ μ΅°ν]
    B --> C[ν„μ¬κ°€ μ •λ³΄ μ΅°ν]
    C --> D[μΆ…λ©λ³„ κ°€μΉ κ³„μ‚°]
    D --> E[μμµλ¥  κ³„μ‚°]
    E --> F[ν¬νΈν΄λ¦¬μ¤ ν†µκ³„ κ³„μ‚°]
    F --> G[μ‘λ‹µ λ°ν™]
```

### λ³΄μ  μ£Όμ‹ μ—…λ°μ΄νΈ ν”λ΅μ°

```mermaid
graph TD
    A[μ²΄κ²° λ°μƒ] --> B[λ³΄μ  μ£Όμ‹ μ΅°ν]
    B --> C{κΈ°μ΅΄ λ³΄μ  μ—¬λ¶€}
    C -->|Yes| D[μλ‰ λ° ν‰λ‹¨κ°€ μ—…λ°μ΄νΈ]
    C -->|No| E[μƒλ΅μ΄ λ³΄μ  μ£Όμ‹ μƒμ„±]
    D --> F[λ³΄μ  μ£Όμ‹ μ €μ¥]
    E --> F
    F --> G[ν¬νΈν΄λ¦¬μ¤ μ¬κ³„μ‚°]
```

## π― API μ—”λ“ν¬μΈνΈ

### Swagger UI μ¤ν¬λ¦°μƒ·

![Portfolio API Endpoints](images/portfolio-api-endpoints.png)

**μ£Όμ” μ—”λ“ν¬μΈνΈ:**

- `GET /api/portfolio` - ν¬νΈν΄λ¦¬μ¤ μ΅°ν (νμ΄μ§€λ„¤μ΄μ… μ§€μ›)

## π“ ν•µμ‹¬ λΉ„μ¦λ‹μ¤ λ΅μ§

### 1. ν¬νΈν΄λ¦¬μ¤ μ΅°ν λ΅μ§

ν¬νΈν΄λ¦¬μ¤ μ΅°ν μ‹ λ‹¤μκ³Ό κ°™μ€ κ³„μ‚°μ΄ μ΄λ£¨μ–΄μ§‘λ‹λ‹¤:

1. **λ³΄μ  μ£Όμ‹ μ΅°ν**: μ‚¬μ©μμ λ¨λ“  λ³΄μ  μ£Όμ‹ μ •λ³΄ μ΅°ν
2. **ν„μ¬κ°€ μ΅°ν**: κ° μΆ…λ©μ μ‹¤μ‹κ°„ ν„μ¬κ°€ μ΅°ν
3. **μΆ…λ©λ³„ κ³„μ‚°**: κ° μΆ…λ©μ ν„μ¬ κ°€μΉ, μ†μµ, μμµλ¥  κ³„μ‚°
4. **ν¬νΈν΄λ¦¬μ¤ μ§‘κ³„**: μ „μ²΄ ν¬νΈν΄λ¦¬μ¤ ν†µκ³„ κ³„μ‚°
5. **μ‘λ‹µ κµ¬μ„±**: ν¬νΈν΄λ¦¬μ¤ μ •λ³΄μ™€ μΆ…λ©λ³„ μƒμ„Έ μ •λ³΄ λ°ν™

### 2. ν¬νΈν΄λ¦¬μ¤ κ°€μΉ κ³„μ‚°

ν¬νΈν΄λ¦¬μ¤ κ°€μΉλ” λ‹¤μκ³Ό κ°™μ΄ κ³„μ‚°λ©λ‹λ‹¤:

```
μ΄ μ£Όμ‹ κ°€μΉ = Ξ£(μΆ…λ©λ³„ ν„μ¬κ°€ Γ— λ³΄μ μλ‰)
μ΄ μμ‚° κ°€μΉ = ν„κΈ + μ΄ μ£Όμ‹ κ°€μΉ
μμ†μµ = μ΄ μμ‚° κ°€μΉ - μ΄κΈ° ν¬μκΈ
```

### 3. μμµλ¥  κ³„μ‚°

μμµλ¥ μ€ λ‹¤μκ³Ό κ°™μ΄ κ³„μ‚°λ©λ‹λ‹¤:

- **μΆ…λ©λ³„ μμµλ¥ **: (ν„μ¬κ°€ - ν‰λ‹¨κ°€) / ν‰λ‹¨κ°€ Γ— 100
- **μ‹¤μ‹κ°„ κ°€κ²© μ΅°ν**: PriceUtilμ„ ν†µν• ν•κµ­ν¬μμ¦κ¶ API μ—°λ™
- **μ •ν™•ν• κ³„μ‚°**: μ†μμ  2μλ¦¬κΉμ§€ μ •ν™•ν• μμµλ¥  κ³„μ‚°

<details>
<summary>π”§ ν•µμ‹¬ κΈ°μ  κµ¬ν„</summary>

**μ‹¤μ‹κ°„ κ°€κ²© μ΅°ν**: PriceUtilμ„ ν†µν• ν•κµ­ν¬μμ¦κ¶ API μ—°λ™μΌλ΅ μ‹¤μ‹κ°„ ν„μ¬κ°€ μ΅°ν

**ν¬νΈν΄λ¦¬μ¤ μ§‘κ³„**: Stream APIλ¥Ό ν™μ©ν• λ³΄μ  μ£Όμ‹ κ·Έλ£Ήν™” λ° μ§‘κ³„ μ²λ¦¬

**Builder ν¨ν„΄**: DTO μƒμ„± μ‹ setter λ€μ‹  Builder ν¨ν„΄ μ‚¬μ©μΌλ΅ λ¶λ³€μ„± λ³΄μ¥

**νμ΄μ§€λ„¤μ΄μ…**: λ€λ‰ ν¬νΈν΄λ¦¬μ¤ λ°μ΄ν„°μ ν¨μ¨μ μΈ μ΅°ν

</details>

## π”— μ—°κ΄€ λ„λ©”μΈ

### User (μ‚¬μ©μ)

- ν¬νΈν΄λ¦¬μ¤ μ†μ μ
- UserStock Entityμ™€ N:1 κ΄€κ³„

### Stock (μΆ…λ©)

- λ³΄μ  μ£Όμ‹ μ •λ³΄
- UserStock Entityμ™€ N:1 κ΄€κ³„

### User (μ‚¬μ©μ)

- ν¬νΈν΄λ¦¬μ¤ μ†μ μ
- UserStock Entityμ™€ N:1 κ΄€κ³„

### Stock (μΆ…λ©)

- λ³΄μ  μ£Όμ‹ μ •λ³΄
- UserStock Entityμ™€ N:1 κ΄€κ³„

## π“ ν¬νΈν΄λ¦¬μ¤ λ¶„μ„ μ§€ν‘

### 1. μμµλ¥  μ§€ν‘

- **κ°λ³„ μΆ…λ© μμµλ¥ **: (ν„μ¬κ°€ - ν‰λ‹¨κ°€) / ν‰λ‹¨κ°€ Γ— 100
- **ν¬νΈν΄λ¦¬μ¤ μμµλ¥ **: μ „μ²΄ ν¬νΈν΄λ¦¬μ¤ μμµλ¥ 
- **κ°€μ¤‘ ν‰κ·  μμµλ¥ **: μΆ…λ©λ³„ κ°€μ¤‘ ν‰κ·  μμµλ¥ 

### 2. λ¦¬μ¤ν¬ μ§€ν‘

- **λ³€λ™μ„±**: ν¬νΈν΄λ¦¬μ¤ κ°€μΉ λ³€λ™μ„±
- **λ² νƒ€**: μ‹μ¥ λ€λΉ„ λ³€λ™μ„±
- **μµλ€ μ†μ‹¤**: μµλ€ μ†μ‹¤ κ°€λ¥ κΈμ•΅
- **VaR (Value at Risk)**: μ„ν— κ°€μΉ

### 3. μ„±κ³Ό μ§€ν‘

- **ROI (Return on Investment)**: ν¬μ μμµλ¥ 
- **Sharpe Ratio**: μ„ν— μ΅°μ • μμµλ¥ 
- **Sortino Ratio**: ν•λ°© μ„ν— μ΅°μ • μμµλ¥ 
- **Calmar Ratio**: μµλ€ μ†μ‹¤ λ€λΉ„ μμµλ¥ 

## β… κµ¬ν„ μƒνƒ

### ν•µμ‹¬ κΈ°λ¥ κµ¬ν„ ν„ν™©

- [x] **λ³΄μ  μ£Όμ‹ κ΄€λ¦¬**: UserStock Entity λ° Repository κµ¬ν„ μ™„λ£
- [x] **ν¬νΈν΄λ¦¬μ¤ μ΅°ν**: μ‹¤μ‹κ°„ ν¬νΈν΄λ¦¬μ¤ κ°€μΉ κ³„μ‚° κµ¬ν„ μ™„λ£
- [x] **μμµλ¥  λ¶„μ„**: μΆ…λ©λ³„, ν¬νΈν΄λ¦¬μ¤ μμµλ¥  κ³„μ‚° κµ¬ν„ μ™„λ£
- [x] **API μ—”λ“ν¬μΈνΈ**: κΈ°λ³Έ ν¬νΈν΄λ¦¬μ¤ API κµ¬ν„ μ™„λ£
- [x] **νμ΄μ§€λ„¤μ΄μ…**: λ³΄μ  μ£Όμ‹ μ΅°ν μ‹ νμ΄μ§€λ„¤μ΄μ… μ§€μ›
- [ ] **ν‰λ‹¨κ°€ κ³„μ‚°**: λ§¤μ μ‹ ν‰λ‹¨κ°€ μλ™ κ³„μ‚° λ΅μ§ (ν–¥ν›„ κµ¬ν„ μμ •)
- [ ] **κ³ κΈ‰ λ¶„μ„ κΈ°λ¥**: λ¦¬μ¤ν¬ λ¶„μ„, μ„±κ³Ό μ§€ν‘ (ν–¥ν›„ κµ¬ν„ μμ •)
- [ ] **ν¬νΈν΄λ¦¬μ¤ μµμ ν™”**: μλ™ λ¦¬λ°Έλ°μ‹± μ μ• (ν–¥ν›„ κµ¬ν„ μμ •)

### λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦

- [x] **λ³΄μ  μ£Όμ‹ λ°μ΄ν„° κ²€μ¦**: μλ‰, ν‰λ‹¨κ°€ μ ν¨μ„± κ²€μ‚¬
- [x] **ν¬νΈν΄λ¦¬μ¤ κ³„μ‚° κ²€μ¦**: κ°€μΉ κ³„μ‚°μ μ •ν™•μ„± κ²€μ¦
- [x] **μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ**: μ²΄κ²° μ‹ μ‹¤μ‹κ°„ ν¬νΈν΄λ¦¬μ¤ μ—…λ°μ΄νΈ

## π›΅οΈ λ°μ΄ν„° λ¬΄κ²°μ„±

### 1. λ³΄μ  μ£Όμ‹ λ°μ΄ν„° κ²€μ¦

- **μλ‰ κ²€μ¦**: λ³΄μ  μλ‰μ μ ν¨μ„± κ²€μ‚¬
- **ν‰λ‹¨κ°€ κ²€μ¦**: ν‰κ·  λ§¤μκ°€μ μ ν¨μ„± κ²€μ‚¬
- **μΌκ΄€μ„± κ²€μ¦**: μ²΄κ²° λ‚΄μ—­κ³Ό λ³΄μ  μ£Όμ‹μ μΌμΉμ„±

### 2. ν¬νΈν΄λ¦¬μ¤ κ³„μ‚° κ²€μ¦

- **κ°€μΉ κ³„μ‚° κ²€μ¦**: ν¬νΈν΄λ¦¬μ¤ κ°€μΉ κ³„μ‚°μ μ •ν™•μ„±
- **μμµλ¥  κ³„μ‚° κ²€μ¦**: μμµλ¥  κ³„μ‚°μ μ •ν™•μ„±
- **μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ**: μ²΄κ²° μ‹ μ‹¤μ‹κ°„ ν¬νΈν΄λ¦¬μ¤ μ—…λ°μ΄νΈ

## π“ μ„±λ¥ μµμ ν™”

### 1. μΏΌλ¦¬ μµμ ν™”

- **μΈλ±μ¤ ν™μ©**: (user_id, stock_id) λ³µν•© μΈλ±μ¤
- **Fetch Join**: μ—°κ΄€ μ—”ν‹°ν‹° μ΅°ν μµμ ν™”
- **μΊμ‹±**: μμ£Ό μ΅°νλλ” ν¬νΈν΄λ¦¬μ¤ μ •λ³΄ μΊμ‹±

### 2. κ³„μ‚° μµμ ν™”

- **λ°°μΉ κ³„μ‚°**: λ€λ‰ ν¬νΈν΄λ¦¬μ¤ κ³„μ‚° μ‹ λ°°μΉ μ²λ¦¬
- **μΊμ‹±**: κ³„μ‚°λ λ¶„μ„ κ²°κ³Ό μΊμ‹±
- **λΉ„λ™κΈ° μ²λ¦¬**: μ‹¤μ‹κ°„ κ°€κ²© μ—…λ°μ΄νΈ λΉ„λ™κΈ° μ²λ¦¬

<details>
<summary>π€ ν™•μ¥ κ°€λ¥μ„±</summary>

### 1. κ³ κΈ‰ λ¶„μ„ κΈ°λ¥

- **κΈ°μ μ  λ¶„μ„**: μ΄λ™ν‰κ· , RSI λ“± κΈ°μ μ  μ§€ν‘
- **κΈ°λ³Έμ  λ¶„μ„**: μ¬λ¬΄μ ν‘ κΈ°λ° λ°Έλ¥μ—μ΄μ…
- **AI λ¶„μ„**: λ¨Έμ‹ λ¬λ‹ κΈ°λ° ν¬νΈν΄λ¦¬μ¤ μµμ ν™”

### 2. ν¬νΈν΄λ¦¬μ¤ μµμ ν™”

- **μλ™ λ¦¬λ°Έλ°μ‹±**: λ©ν‘ μμ‚° λ°°λ¶„ μλ™ μ΅°μ •
- **λ¦¬μ¤ν¬ κ΄€λ¦¬**: μλ™ λ¦¬μ¤ν¬ μ΅°μ •
- **μ„±κ³Ό λ¨λ‹ν„°λ§**: μ‹¤μ‹κ°„ μ„±κ³Ό λ¨λ‹ν„°λ§

### 3. μ•λ¦Ό κΈ°λ¥

- **μμµλ¥  μ•λ¦Ό**: λ©ν‘ μμµλ¥  λ‹¬μ„± μ‹ μ•λ¦Ό
- **μ†μ‹¤ μ•λ¦Ό**: μ†μ‹¤ ν•λ„ λ„λ‹¬ μ‹ μ•λ¦Ό
- **λ¦¬λ°Έλ°μ‹± μ•λ¦Ό**: μμ‚° λ°°λ¶„ λ¶κ· ν• μ‹ μ•λ¦Ό

### 4. λ¦¬ν¬νΈ κΈ°λ¥

- **ν¬νΈν΄λ¦¬μ¤ λ¦¬ν¬νΈ**: μ›”λ³„/λ¶„κΈ°λ³„ ν¬νΈν΄λ¦¬μ¤ λ¦¬ν¬νΈ
- **μ„±κ³Ό λ¶„μ„ λ¦¬ν¬νΈ**: ν¬μ μ„±κ³Ό μƒμ„Έ λ¶„μ„
- **λ¦¬λ°Έλ°μ‹± λ¦¬ν¬νΈ**: ν¬νΈν΄λ¦¬μ¤ μµμ ν™” μ μ•
</details>

---

_μ΄ λ¬Έμ„λ” Motoo ν”„λ΅μ νΈμ Portfolio λ„λ©”μΈ μ„¤κ³„λ¥Ό μ„¤λ…ν•©λ‹λ‹¤._
