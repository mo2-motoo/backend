# Motoo Database Schema Documentation

## üìä Database Entity Relationship Diagram

#### pdf url
[ERDCloud URL](https://github.com/mo2-motoo/backend/blob/main/docs/Motoo_ERD.pdf)
[ERD Îã§Ïù¥Ïñ¥Í∑∏Îû® pdf](https://github.com/mo2-motoo/backend/blob/main/docs/Motoo_ERD.pdf)

<details>
<summary>üìã ERD Îã§Ïù¥Ïñ¥Í∑∏Îû® Î≥¥Í∏∞/Ïà®Í∏∞Í∏∞</summary>

```mermaid
erDiagram
    users {
        bigint id PK
        varchar username UK
        varchar email UK
        bigint seed_money
        bigint cash
        datetime join_at
        datetime created_at
        datetime updated_at
    }

    industries {
        bigint id PK
        varchar name
        datetime created_at
        datetime updated_at
    }

    stocks {
        varchar stock_code PK
        varchar stock_name
        varchar outline
        varchar market_type
        boolean is_active
        int ranking
        bigint industry_id FK
        datetime created_at
        datetime updated_at
    }

    stock_price_minute {
        varchar stock_code PK,FK
        datetime timestamp PK
        bigint open_price
        bigint high_price
        bigint low_price
        bigint close_price
        bigint volume
        bigint amount
        datetime created_at
        datetime updated_at
    }

    stock_price_hour {
        varchar stock_code PK,FK
        datetime timestamp PK
        bigint open_price
        bigint high_price
        bigint low_price
        bigint close_price
        bigint volume
        bigint amount
        datetime created_at
        datetime updated_at
    }

    stock_price_daily {
        varchar stock_code PK,FK
        date date PK
        bigint open_price
        bigint high_price
        bigint low_price
        bigint close_price
        bigint volume
        bigint amount
        datetime created_at
        datetime updated_at
    }

    financial_statements {
        bigint id PK
        varchar stock_code FK
        date report_date
        varchar report_type
        bigint revenue
        bigint operating_income
        bigint net_income
        bigint total_assets
        bigint total_equity
        bigint total_liabilities
        bigint total_shares
        bigint outstanding_shares
        double eps
        double bps
        double per
        double pbr
        double roe
        double debt_ratio
        datetime created_at
        datetime updated_at
    }

    orders {
        bigint id PK
        bigint user_id FK
        bigint stock_id FK
        varchar order_type
        bigint quantity
        bigint price
        datetime created_at
        varchar status
        datetime created_at
        datetime updated_at
    }

    executions {
        bigint id PK
        bigint user_id FK
        bigint stock_id FK
        varchar order_type
        bigint quantity
        bigint executed_price
        datetime executed_at
        datetime created_at
        datetime updated_at
    }

    user_stocks {
        bigint id PK
        bigint user_id FK
        bigint stock_id FK
        bigint quantity
        bigint average_buy_price
        datetime created_at
        datetime updated_at
    }

    tokens {
        bigint id PK
        text access_token
        datetime expiration
    }

    transaction_histories {
        bigint id PK
        bigint user_id FK
        bigint amount
        varchar description
        datetime created_at
        datetime updated_at
    }

    %% Relationships
    users ||--o{ orders : "places"
    users ||--o{ executions : "has"
    users ||--o{ user_stocks : "owns"
    users ||--o{ transaction_histories : "has"

    industries ||--o{ stocks : "contains"

    stocks ||--o{ stock_price_minute : "has"
    stocks ||--o{ stock_price_hour : "has"
    stocks ||--o{ stock_price_daily : "has"
    stocks ||--o{ financial_statements : "has"
    stocks ||--o{ orders : "traded_in"
    stocks ||--o{ executions : "traded_in"
    stocks ||--o{ user_stocks : "held_by"

    orders ||--|| executions : "results_in"
```

</details>

## üóÑÔ∏è Database DDL (Data Definition Language)

```sql
-- Users table
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(30) NOT NULL UNIQUE,
    email VARCHAR(50) NOT NULL UNIQUE,
    seed_money BIGINT NOT NULL,
    cash BIGINT NOT NULL,
    join_at DATETIME NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Industries table
CREATE TABLE industries (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(50) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Stocks table
CREATE TABLE stocks (
    stock_code VARCHAR(10) PRIMARY KEY,
    stock_name VARCHAR(50) NOT NULL,
    outline VARCHAR(255),
    market_type VARCHAR(20),
    is_active BOOLEAN NOT NULL DEFAULT TRUE,
    ranking INT,
    industry_id BIGINT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (industry_id) REFERENCES industries(id)
);

-- Stock Price Minute table (Î≥µÌï©ÌÇ§)
CREATE TABLE stock_price_minute (
    stock_code VARCHAR(10) NOT NULL,
    timestamp DATETIME NOT NULL,
    open_price BIGINT NOT NULL,
    high_price BIGINT NOT NULL,
    low_price BIGINT NOT NULL,
    close_price BIGINT NOT NULL,
    volume BIGINT NOT NULL,
    amount BIGINT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (stock_code, timestamp),
    FOREIGN KEY (stock_code) REFERENCES stocks(stock_code)
);

-- Stock Price Hour table (Î≥µÌï©ÌÇ§)
CREATE TABLE stock_price_hour (
    stock_code VARCHAR(10) NOT NULL,
    timestamp DATETIME NOT NULL,
    open_price BIGINT NOT NULL,
    high_price BIGINT NOT NULL,
    low_price BIGINT NOT NULL,
    close_price BIGINT NOT NULL,
    volume BIGINT NOT NULL,
    amount BIGINT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (stock_code, timestamp),
    FOREIGN KEY (stock_code) REFERENCES stocks(stock_code)
);

-- Stock Price Daily table (Î≥µÌï©ÌÇ§)
CREATE TABLE stock_price_daily (
    stock_code VARCHAR(10) NOT NULL,
    date DATE NOT NULL,
    open_price BIGINT NOT NULL,
    high_price BIGINT NOT NULL,
    low_price BIGINT NOT NULL,
    close_price BIGINT NOT NULL,
    volume BIGINT NOT NULL,
    amount BIGINT,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (stock_code, date),
    FOREIGN KEY (stock_code) REFERENCES stocks(stock_code)
);

-- Financial Statements table
CREATE TABLE financial_statements (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    stock_code VARCHAR(10) NOT NULL,
    report_date DATE NOT NULL,
    report_type VARCHAR(10) NOT NULL,
    revenue BIGINT,
    operating_income BIGINT,
    net_income BIGINT,
    total_assets BIGINT,
    total_equity BIGINT,
    total_liabilities BIGINT,
    total_shares BIGINT,
    outstanding_shares BIGINT,
    eps DOUBLE,
    bps DOUBLE,
    per DOUBLE,
    pbr DOUBLE,
    roe DOUBLE,
    debt_ratio DOUBLE,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (stock_code) REFERENCES stocks(stock_code)
);

-- Orders table
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    stock_id BIGINT NOT NULL,
    order_type VARCHAR(10) NOT NULL,
    quantity BIGINT NOT NULL,
    price BIGINT NOT NULL,
    created_at DATETIME NOT NULL,
    status VARCHAR(15) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (stock_id) REFERENCES stocks(stock_code)
);

-- Executions table
CREATE TABLE executions (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    stock_id BIGINT NOT NULL,
    order_type VARCHAR(10) NOT NULL,
    quantity BIGINT NOT NULL,
    executed_price BIGINT NOT NULL,
    executed_at DATETIME NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (stock_id) REFERENCES stocks(stock_code)
);

-- User Stocks table
CREATE TABLE user_stocks (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    stock_id BIGINT NOT NULL,
    quantity BIGINT NOT NULL,
    average_buy_price BIGINT NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id),
    FOREIGN KEY (stock_id) REFERENCES stocks(stock_code)
);

-- Tokens table
CREATE TABLE tokens (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    access_token LONGTEXT,
    expiration DATETIME
);

-- Transaction Histories table
CREATE TABLE transaction_histories (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT NOT NULL,
    amount BIGINT NOT NULL,
    description VARCHAR(100) NOT NULL,
    created_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

-- Indexes for performance
CREATE INDEX idx_stocks_market_type ON stocks(market_type);
CREATE INDEX idx_stocks_is_active ON stocks(is_active);
CREATE INDEX idx_stock_price_minute_stock_timestamp ON stock_price_minute(stock_code, timestamp);
CREATE INDEX idx_stock_price_hour_stock_timestamp ON stock_price_hour(stock_code, timestamp);
CREATE INDEX idx_stock_price_daily_stock_date ON stock_price_daily(stock_code, date);
CREATE INDEX idx_financial_statements_stock_date ON financial_statements(stock_code, report_date);
CREATE INDEX idx_orders_user_status ON orders(user_id, status);
CREATE INDEX idx_executions_user ON executions(user_id);
CREATE INDEX idx_user_stocks_user ON user_stocks(user_id);
```

## üéØ ÌïµÏã¨ ÏÑ§Í≥Ñ Ìè¨Ïù∏Ìä∏

### 1. **Î≥µÌï©ÌÇ§Î•º ÌôúÏö©Ìïú ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞ ÏÑ§Í≥Ñ**

**Stock Price Tables (Minute/Hour/Daily)**

- **Î≥µÌï©ÌÇ§ ÏÇ¨Ïö© Ïù¥Ïú†**: ÎèôÏùºÌïú Ï¢ÖÎ™©Ïùò Ïó¨Îü¨ ÏãúÏ†ê Îç∞Ïù¥ÌÑ∞Î•º Ìö®Ïú®Ï†ÅÏúºÎ°ú Ï†ÄÏû•
- **ÏÑ±Îä• ÏµúÏ†ÅÌôî**: Ï¢ÖÎ™©ÏΩîÎìú + ÏãúÍ∞ÑÏúºÎ°ú Îπ†Î•∏ Ï°∞Ìöå Í∞ÄÎä•
- **Îç∞Ïù¥ÌÑ∞ Î¨¥Í≤∞ÏÑ±**: Ï§ëÎ≥µ Îç∞Ïù¥ÌÑ∞ Î∞©ÏßÄ

```java
// Î≥µÌï©ÌÇ§ ÌÅ¥ÎûòÏä§ ÏòàÏãú
public class StockPriceMinuteId implements Serializable {
    private String stockCode;  // Ï¢ÖÎ™©ÏΩîÎìú
    private LocalDateTime timestamp;  // ÏãúÍ∞Ñ
}
```

### 2. **Stock EntityÏùò Primary Key ÏÑ§Í≥Ñ**

**Ï¢ÖÎ™©ÏΩîÎìúÎ•º Primary KeyÎ°ú ÏÇ¨Ïö©**

- **Ïù¥Ïú†**: ÌïúÍµ≠Ìà¨ÏûêÏ¶ùÍ∂å APIÏóêÏÑú Ï¢ÖÎ™©ÏΩîÎìúÍ∞Ä Í≥†Ïú† ÏãùÎ≥ÑÏûê
- **Ïû•Ï†ê**: API Ïó∞Îèô Ïãú ÏûêÏó∞Ïä§Îü¨Ïö¥ Îß§Ìïë
- **ÏÑ±Îä•**: Ï¢ÖÎ™©ÏΩîÎìúÎ°ú ÏßÅÏ†ë Ï°∞Ìöå Í∞ÄÎä•

```java
@Entity
public class Stock extends BaseEntity {
    @Id
    @Column(name = "stock_code", length = 10)
    private String stockCode;  // "005930" (ÏÇºÏÑ±Ï†ÑÏûê)
}
```

### 3. **Ïû¨Î¨¥Ï†úÌëú Îç∞Ïù¥ÌÑ∞Ïùò Ï†ïÍ∑úÌôî ÏÑ§Í≥Ñ**

**FinancialStatement Entity**

- **Î∂ÑÎ¶¨ Ïù¥Ïú†**: Ïû¨Î¨¥Ï†úÌëúÎäî Î∂ÑÍ∏∞Î≥Ñ/Ïó∞Í∞ÑÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏ÎêòÎØÄÎ°ú Î≥ÑÎèÑ ÌÖåÏù¥Î∏î Í¥ÄÎ¶¨
- **Í≥ÑÏÇ∞Îêú ÏßÄÌëú Ï†ÄÏû•**: EPS, BPS, PER, PBR Îì± ÎØ∏Î¶¨ Í≥ÑÏÇ∞ÌïòÏó¨ Ï†ÄÏû•
- **ÏÑ±Îä•**: Ïã§ÏãúÍ∞Ñ Í≥ÑÏÇ∞ ÎåÄÏã† Ï†ÄÏû•Îêú Í∞í ÏÇ¨Ïö©

```java
@Entity
public class FinancialStatement extends BaseEntity {
    private Double eps;  // Ï£ºÎãπÏàúÏù¥Ïùµ
    private Double bps;  // Ï£ºÎãπÏàúÏûêÏÇ∞
    private Double per;  // Ï£ºÍ∞ÄÏàòÏùµÎπÑÏú®
    private Double pbr;  // Ï£ºÍ∞ÄÏàúÏûêÏÇ∞ÎπÑÏú®
}
```

### 4. **ÏÇ¨Ïö©Ïûê Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ ÏÑ§Í≥Ñ**

**UserStock Entity**

- **ÌèâÎã®Í∞Ä Í¥ÄÎ¶¨**: Îß§Ïàò ÏãúÎßàÎã§ ÌèâÍ∑† Îß§ÏàòÍ∞Ä ÏûêÎèô Í≥ÑÏÇ∞
- **ÏàòÎüâ Í¥ÄÎ¶¨**: Î≥¥Ïú† Ï£ºÏãù ÏàòÎüâ Ï∂îÏ†Å
- **ÏÑ±Îä•**: ÏÇ¨Ïö©ÏûêÎ≥Ñ Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï°∞Ìöå ÏµúÏ†ÅÌôî

```java
@Entity
public class UserStock extends BaseEntity {
    private Long quantity;           // Î≥¥Ïú† ÏàòÎüâ
    private Long averageBuyPrice;    // ÌèâÍ∑† Îß§ÏàòÍ∞Ä
}
```

### 5. **Ï£ºÎ¨∏-Ï≤¥Í≤∞ Î∂ÑÎ¶¨ ÏÑ§Í≥Ñ**

**Order ‚Üî Execution Í¥ÄÍ≥Ñ**

- **Order**: Ï£ºÎ¨∏ Ï†ïÎ≥¥ (PENDING, COMPLETED, CANCELLED)
- **Execution**: Ïã§Ï†ú Ï≤¥Í≤∞ Ï†ïÎ≥¥ (Ï≤¥Í≤∞Í∞Ä, Ï≤¥Í≤∞ÏãúÍ∞Ñ)
- **Ïù¥Ïú†**: Ï£ºÎ¨∏Í≥º Ï≤¥Í≤∞ÏùÄ Î≥ÑÎèÑÎ°ú Í¥ÄÎ¶¨ÎêòÏñ¥Ïïº Ìï®

### 6. **BaseEntityÎ•º ÌÜµÌïú Í≥µÌÜµ ÌïÑÎìú Í¥ÄÎ¶¨**

**Î™®Îì† EntityÍ∞Ä ÏÉÅÏÜçÌïòÎäî BaseEntity**

```java
public abstract class BaseEntity {
    @CreatedDate
    private LocalDateTime createdAt;

    @LastModifiedDate
    private LocalDateTime updatedAt;
}
```

### 7. **Ïù∏Îç±Ïä§ Ï†ÑÎûµ**

**ÏÑ±Îä• ÏµúÏ†ÅÌôîÎ•º ÏúÑÌïú Ïù∏Îç±Ïä§**

- **Ï¢ÖÎ™©Î≥Ñ ÏãúÍ≥ÑÏó¥ Ï°∞Ìöå**: `(stock_code, timestamp)`
- **ÏÇ¨Ïö©ÏûêÎ≥Ñ Ï£ºÎ¨∏ Ï°∞Ìöå**: `(user_id, status)`
- **ÌôúÏÑ± Ï¢ÖÎ™© Ï°∞Ìöå**: `(is_active)`

### 8. **Îç∞Ïù¥ÌÑ∞ ÌÉÄÏûÖ ÏÑ†ÌÉù**

**BIGINT ÏÇ¨Ïö© Ïù¥Ïú†**

- **Ï£ºÏãù Í∞ÄÍ≤©**: ÌïúÍµ≠ Ï£ºÏãùÏùÄ ÏµúÎåÄ 1,000,000ÏõêÍπåÏßÄ Í∞ÄÎä•
- **Í±∞ÎûòÎüâ**: ÎåÄÏö©Îüâ Í±∞ÎûòÎüâ Ï≤òÎ¶¨
- **Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞**: ÎåÄÍ∑úÎ™® Í∏∞ÏóÖÏùò Ïû¨Î¨¥ Îç∞Ïù¥ÌÑ∞

## üîÑ Îç∞Ïù¥ÌÑ∞ ÌîåÎ°úÏö∞

1. **Ï¢ÖÎ™© Ï†ïÎ≥¥ ÏàòÏßë** ‚Üí `stocks` ÌÖåÏù¥Î∏î
2. **ÏãúÏÑ∏ Îç∞Ïù¥ÌÑ∞ ÏàòÏßë** ‚Üí `stock_price_*` ÌÖåÏù¥Î∏îÎì§
3. **Ïû¨Î¨¥Ï†úÌëú ÏàòÏßë** ‚Üí `financial_statements` ÌÖåÏù¥Î∏î
4. **ÏÇ¨Ïö©Ïûê Ï£ºÎ¨∏** ‚Üí `orders` ÌÖåÏù¥Î∏î
5. **Ï£ºÎ¨∏ Ï≤¥Í≤∞** ‚Üí `executions` ÌÖåÏù¥Î∏î + `user_stocks` ÏóÖÎç∞Ïù¥Ìä∏
6. **Ìè¨Ìä∏Ìè¥Î¶¨Ïò§ Ï°∞Ìöå** ‚Üí `user_stocks` + `stock_price_*` Ï°∞Ïù∏

## üìà ÌôïÏû•ÏÑ± Í≥†Î†§ÏÇ¨Ìï≠

- **ÌååÌã∞ÏÖîÎãù**: ÏãúÍ≥ÑÏó¥ Îç∞Ïù¥ÌÑ∞Îäî ÎÇ†ÏßúÎ≥Ñ ÌååÌã∞ÏÖîÎãù Í≥†Î†§
- **ÏÉ§Îî©**: ÏÇ¨Ïö©ÏûêÎ≥Ñ Îç∞Ïù¥ÌÑ∞ ÏÉ§Îî© Í∞ÄÎä•
- **Ï∫êÏã±**: ÏûêÏ£º Ï°∞ÌöåÎêòÎäî ÏãúÏÑ∏ Îç∞Ïù¥ÌÑ∞ Redis Ï∫êÏã±
- **ÏïÑÏπ¥Ïù¥Îπô**: Ïò§ÎûòÎêú ÏãúÏÑ∏ Îç∞Ïù¥ÌÑ∞ ÏïÑÏπ¥Ïù¥Îπô Ï†ÑÎûµ

---

_Ïù¥ Î¨∏ÏÑúÎäî Motoo ÌîÑÎ°úÏ†ùÌä∏Ïùò Îç∞Ïù¥ÌÑ∞Î≤†Ïù¥Ïä§ Ïä§ÌÇ§Îßà ÏÑ§Í≥ÑÎ•º ÏÑ§Î™ÖÌï©ÎãàÎã§._
